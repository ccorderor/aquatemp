# Home Assistant Aquatemp Heat Pump Climate Entity (custom component)

This is Home Assistant's custom climate entity to control AquaTemp-compatible heat pumps through AquaTemp cloud API.
It allows controlling temperature, HVAC mode (heat, cool, auto, off) and fan mode (low, auto).
It also reports temperatures, status, faults through binary sensors and sensors.
AquaTemp's cloud protocol is based on dst6se's https://github.com/dst6se/aquatemp project with additional functionality.

[Changelog](https://github.com/radical-squared/aquatemp/blob/master/CHANGELOG.md)

## How to

#### Requirements

- Account for AquaTemp

#### Switching from 1.x/2.x to 3.x

Requires complete deletion of integration and reinstall after restart HA

#### Installations via HACS [![hacs_badge](https://img.shields.io/badge/HACS-Custom-41BDF5.svg)](https://github.com/hacs/integration)

- In HACS, look for "Aqua Temp" and install and restart
- If integration was not found, please add custom repository `radical-squared/aquatemp` as integration
- In Settings --> Devices & Services - (Lower Right) "Add Integration"

#### Setup

To add integration use Configuration -> Integrations -> Add `Aqua Temp`
Integration supports **multiple** accounts and devices

| Fields name | Type    | Required | Default | Description                       |
| ----------- | ------- | -------- | ------- | --------------------------------- |
| Username    | Textbox | +        | -       | Username of AquaTemp account      |
| Password    | Textbox | +        | -       | Password for the AquaTemp account |

###### Validation errors

| Errors                    |
| ------------------------- |
| Invalid credentials (403) |

## HA Device

Device scheme is according to data from the API

```json
{
  "identifiers": ["aqua_temp", "{DEVICE ID}"],
  "name": "{DEVICE NICK NAME or DEVICE CODE}",
  "device_type": "{DEVICE TYPE}"
}
```

## HA Components

Per device the following components will be generated by default:

| Entity Name                       | Parameter        | Platform      | Protocol Code? |
| --------------------------------- | ---------------- | ------------- | -------------- |
| {HA Device Name} Temperature Unit | temperature_unit | select        | False          |
| {HA Device Name} Fault            | is_fault         | binary_sensor | False          |
| {HA Device Name} Status           | device_status    | binary_sensor | False          |

### Per product ID

Additional components are according to following mapping:

| Device's Product ID          | Parameter                                                                                                                       |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| Default                      | [JSON](https://github.com/radical-squared/aquatemp/blob/master/custom_components/aqua_temp/parameters/default.json)             |
| Hitemp 1245226668902080512   | [JSON](https://github.com/radical-squared/aquatemp/blob/master/custom_components/aqua_temp/parameters/1245226668902080512.json) |
| AquaTemp 1442284873216843776 | [JSON](https://github.com/radical-squared/aquatemp/blob/master/custom_components/aqua_temp/parameters/1442284873216843776.json) |

_Note:_

If mapping for your device are incorrect, please follow the steps below before reporting an issue:

1. Install on your mobile device packet sniffer (I'm using for Android - NetCapture)
2. Activate the packet sniffer just for the app
3. Open the app
4. Login
5. Open relevant device
6. Open menu
7. Click on `Parameter Settings`
8. First cycle, use password for user parameters, code: `022`
9. Take screenshot of each screen (letter)
10. Repeat steps 8 & 9 with code `066` - factory parameters
11. Open packet sniffer app and extract requests (and responses) of `login`, `deviceList`, `getDataByCode`

Attach the following details to issue:

- Mobile App name and version
- Attach screenshots and logs as zip file or link for download
- Attach diagnostic details from HA integration

## Run API over CLI

### Requirements

- Python 3.10
- Python virtual environment
- Install all dependencies, using `pip install -r requirements.txt` command

### Environment variables

| Environment Variable | Type    | Default | Description                                                                                                               |
| -------------------- | ------- | ------- | ------------------------------------------------------------------------------------------------------------------------- |
| Username             | String  | -       | Username used for Aqua Temp                                                                                               |
| Password             | String  | -       | Password used for Aqua Temp                                                                                               |
| DEBUG                | Boolean | False   | Setting to True will present DEBUG log level message while testing the code, False will set the minimum log level to INFO |

### Execution

Run file located in `tests/main.py`

## Troubleshooting

Before opening an issue, please provide logs related to the issue,
For debug log level, please add the following to your config.yaml

```yaml
logger:
  default: warning
  logs:
    custom_components.aqua_temp: debug
```

Please attach also diagnostic details of the integration, available in:
Settings -> Devices & Services -> Aqua Temp -> 3 dots menu -> Download diagnostics
